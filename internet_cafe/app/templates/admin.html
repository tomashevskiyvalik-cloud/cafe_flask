{% extends 'base.html' %}

{% block title %}–ê–¥–º—ñ–Ω–∫–∞ - –ö–∞—Ñ–µ{% endblock %}

{% block content %}

<h1>–ê–¥–º—ñ–Ω–∫–∞</h1>

<!-- üçΩÔ∏è –ú–ï–ù–Æ -->
<h2>–ú–µ–Ω—é</h2>
<a href="{{ url_for('admin.add_tovar') }}">
  <button>‚ûï –î–æ–¥–∞—Ç–∏ —Å—Ç—Ä–∞–≤—É</button>
</a>

<div class="tovar-list">
  {% for tovar in tovary %}
    <div class="tovar-card">
      <h3>{{ tovar.nazva }}</h3>
      <p>{{ tovar.opis }}</p>
      <p><strong>{{ tovar.tsina }} –≥—Ä–Ω</strong></p>

      {% if tovar.image_filename %}
        <img
          src="{{ url_for('static', filename='uploads/tovary/' ~ tovar.image_filename) }}"
          style="max-width:120px; border-radius:8px;"
        >
      {% endif %}

      <div style="display:flex; gap:8px; margin-top:8px;">
        <a href="{{ url_for('admin.edit_tovar', id=tovar.id) }}">
          <button>‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
        </a>

        <form action="{{ url_for('admin.delete_tovar', id=tovar.id) }}" method="POST">
          <button type="submit" onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Å—Ç—Ä–∞–≤—É?');">
            üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
          </button>
        </form>
      </div>
    </div>
  {% else %}
    <p>–ú–µ–Ω—é –ø–æ—Ä–æ–∂–Ω—î.</p>
  {% endfor %}
</div>

<hr>

<!-- üí¨ –í–Ü–î–ì–£–ö–ò -->
<h2>–í—ñ–¥–≥—É–∫–∏</h2>
{% for fb in feedbacks %}
  <div class="feedback-item">
    <p><strong>{{ fb.name }}</strong> ({{ fb.email }})</p>
    <p>{{ fb.message }}</p>
    <small>{{ fb.created_at.strftime('%d-%m-%Y %H:%M') }}</small>

    <form action="{{ url_for('admin.delete_feedback', id=fb.id) }}" method="POST">
      <button type="submit" onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≤—ñ–¥–≥—É–∫?');">
        üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
      </button>
    </form>
  </div>
{% else %}
  <p>–í—ñ–¥–≥—É–∫—ñ–≤ –Ω–µ–º–∞—î.</p>
{% endfor %}

<hr>

<!-- üõí –ó–ê–ú–û–í–õ–ï–ù–ù–Ø -->
<h2>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
{% for order in orders %}
  <div class="feedback-item">
    <p><strong>{{ order.name }}</strong> ‚Äî {{ order.phone }}</p>
    <p>–°—Ç—Ä–∞–≤–∞: {{ order.tovar.nazva }} | –ö—ñ–ª—å–∫—ñ—Å—Ç—å: {{ order.quantity }}</p>
    <p>–°—Ç–∞—Ç—É—Å: <strong>{{ order.status }}</strong></p>
    <small>{{ order.created_at.strftime('%d-%m-%Y %H:%M') }}</small>

    <!-- üîÑ –°–¢–ê–¢–£–° -->
    <form action="{{ url_for('admin.order_status', id=order.id) }}" method="POST" style="margin-top:6px;">
      <select name="status">
        <option value="NEW" {% if order.status=='NEW' %}selected{% endif %}>NEW</option>
        <option value="COOKING" {% if order.status=='COOKING' %}selected{% endif %}>COOKING</option>
        <option value="DONE" {% if order.status=='DONE' %}selected{% endif %}>DONE</option>
        <option value="CANCELED" {% if order.status=='CANCELED' %}selected{% endif %}>CANCELED</option>
      </select>
      <button type="submit">–û–Ω–æ–≤–∏—Ç–∏</button>
    </form>

    <!-- ‚ùå –í–ò–î–ê–õ–ï–ù–ù–Ø -->
    <form action="{{ url_for('admin.delete_order', id=order.id) }}" method="POST" style="margin-top:4px;">
      <button type="submit" onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?');">
        üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
      </button>
    </form>
  </div>
{% else %}
  <p>–ó–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î.</p>
{% endfor %}

{% endblock %}